<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <link href="/resources/main.css" rel="stylesheet">
    <link href="/resources/jquery.datetimepicker.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="/resources/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="/resources/getstudents.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="/resources/jquery.datetimepicker.full.js"></script>
</head>
<body>
<title>Система управления баллами по АИП для студентов УИР</title>
<center><h1 class="ribbon"><strong class="ribbon-content">Система управления баллами по АИП для студентов УИР</strong></h1></center>
<a href="/login" target="_blank" class="great_btn">
    <right> <button>Вход для преподавателя</button></right>
</a>

<p>
    <input id="date_timepicker_start" type="text" />
    <input id="date_timepicker_end" type="text" />
    <input type="button" id="find" value="Найти">
</p>
<table id="all-student-table" class="features-table">
    <thead>
    <tr>
        <th>Имя и Фамилия студента</th>
        <th>Количество баллов</th>
        <th>Количество пропусков студента</th>
    </tr>
    </thead>
    <tbody id="all-student">
    </tbody>
</table>


<script type="text/javascript">
    jQuery(function(){
        jQuery('#date_timepicker_start').datetimepicker({
            format:'Y/m/d',
            onShow:function( ct ){
                this.setOptions({
                    maxDate:jQuery('#date_timepicker_end').val()?jQuery('#date_timepicker_end').val():false
                })
            },
            timepicker:false
        });
        jQuery('#date_timepicker_end').datetimepicker({
            format:'Y/m/d',
            onShow:function( ct ){
                this.setOptions({
                    minDate:jQuery('#date_timepicker_start').val()?jQuery('#date_timepicker_start').val():false
                })
            },
            timepicker:false
        });
    });

    $('#find').click(function () {
        var dateFrom = $('#date_timepicker_start').val();
        var dateTo = $('#date_timepicker_end').val();
        dateFrom = dateFrom.length == 0 ? '' : "?dateFrom="+dateFrom;
        dateTo = dateTo.length == 0 ? '' : "&dateTo="+dateTo;
        $.ajax({
            type: "GET",
            url: "/student/dates"+dateFrom+dateTo,
            contentType: "application/json",
            dataType: 'json',
            success: function (parsedStudents) {
                var studentsTable = document.getElementById('all-student-table');
                studentsTable.innerHTML="<tr><th>Имя и Фамилия студента</th><th>Количество баллов</th><th>Количество пропусков студента</th></tr>";
                parsedStudents.forEach(function(item)  {
                    var fullNameElement = document.createElement('td');
                    fullNameElement.innerHTML = '<p>' + item['fullName'] + '</p>';
                    var estimateElement = document.createElement('td');
                    var estimateValue = item.estimate === null? 0 : item.estimate.estimate;
                    var exEstimateValue = item.extEstimate === null? 0 : item.extEstimate.estimate;
                    estimateValue = isNaN(parseInt(estimateValue)+parseInt(exEstimateValue)) ? '' : parseInt(estimateValue)+parseInt(exEstimateValue);
                    estimateElement.innerHTML = '<p>' + estimateValue + '</p>';
                    var respectElement = document.createElement('td');
                    var respectValue = item.dateList === null? 0 : item.dateList.respectCause;
                    var notRespectCause = item.dateList === null? 0 : item.dateList.notRespectCause;
                    respectValue = isNaN(parseInt(respectValue)+parseInt(notRespectCause)) ? '' : parseInt(respectValue)+parseInt(notRespectCause);
                    respectElement.innerHTML = '<p>' + respectValue + '</p>';

                    var elementContainer = document.createElement('tr');
                    elementContainer.appendChild(fullNameElement);
                    elementContainer.appendChild(estimateElement);
                    elementContainer.appendChild(respectElement);
                    studentsTable.appendChild(elementContainer);
                });
            },
            error: function (data) {
                alert("Не удалось загрузить студентов!");
            }
        });
    });
</script>
</body>
</html>